---
title: "Country Analysis Template"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: journal
---

## Background

The overall goal of this project is to reduce morbidity and mortality of sick children attending primary care facilities while supporting the rational and efficient use of diagnostics and medicines by healthcare providers. This study is focused on generating evidence for pulse oximetry and clinical decision support algorithms (CDSAs) in primary care. To determine the performance of the multimodal PO devices under investigation in this study, a cross-sectional diagnostic accuracy study will compare the index multimodal PO devices to an accepted reference standard.

The primary objective of this study is to determine the performance of available multimodal PO devices compared to an accepted reference standard by primary care providers assessing chidlren 0-59 months seeking care at the primary care level. Reference standards for the different clinical measurements include: Masimo Rad97 patient monitor (SpO2, PR), video derived annotated respiratory rate (RR), and digital infrared thermometer (temp). Secondary objectives include determining if any variability in performance is detected by age category or skin pigmentation and assessing interrater reliability.

```{r setup, include=FALSE}
rm(list = ls())

# Rmd setup (since we echo all code)
knitr::opts_chunk$set(echo = FALSE)

# install these packages if not already on your computer
library(plyr)
library(dplyr)
library(tableone)
library(kableExtra)
library(BlandAltmanLeh)
library(irr)
library(exactci)
library(reshape2)
library(ggplot2)

# Read in (cleaned) data 
# Create a text file with the name ".Renviron", then define the variables as defined below
# filename = "dx-accuracy-data_clean_2023-11-17.csv"
# COUNTRY = "Tanzania"
# After adding the file and content restart R session and you are good to go
# The Renviron will be ingored when pushing changes to Github

filename <- Sys.getenv("filename")
df_og <- read.csv(filename)
df_og <- df_og %>% select(-c("X"))

# Define country and subset
# COUNTRY <- "Kenya" # Kenya, Tanzania, India -- USER INPUT HERE
COUNTRY <- Sys.getenv("COUNTRY")
df_og <- subset(df_og, df_og$country==COUNTRY)
```

```{r long_dfs}
# --- SECTION 1: CREATING LONG DF
# Create reshaped df's
## use regular expressions to identify measurement-related columns and trim to only variables needed
df_reshaped <- df_og %>% select(ppt_id, index_device_name, age_months, age_cat, colnames(df_og[grepl("m[[:digit:]]_index_+", names(df_og))]), colnames(df_og[grepl("therm", names(df_og))]), colnames(df_og[grepl("m[[:digit:]]_ref_+", names(df_og))]))
df_reshaped <- df_reshaped %>% select(-c(colnames(df_og[grepl("error", names(df_og))]), colnames(df_og[grepl("attempt", names(df_og))]), colnames(df_og[grepl("thb", names(df_og))])))
mdf_reshaped <- melt(df_reshaped, id.vars = c("ppt_id", "index_device_name", "age_months", "age_cat")) ## Melt df into long format, maintaining ID vars
mdf_reshaped$grp <- toupper(substr(mdf_reshaped$variable, start = 1, stop = 2)) # Extract measurement number into grouping variable
mdf_reshaped$mes <- substr(mdf_reshaped$variable, start = 4, stop = nchar(as.character(mdf_reshaped$variable))) # Extract index/ref and measurement type into variable
mdf_reshaped <- mdf_reshaped %>% select(-c(variable))
mdf_reshaped$mes <- ifelse(mdf_reshaped$mes=="therm_skin_temp", "ref_temp", mdf_reshaped$mes)
## Subset into index measurments only, further subset into each measurement type so value can be renamed accordingly
mdf_reshaped_i <- subset(mdf_reshaped, grepl("index", mdf_reshaped$mes))
mdf_reshaped_i_temp <- subset(mdf_reshaped_i, grepl("temp", mdf_reshaped_i$mes)) # Temp
names(mdf_reshaped_i_temp)[5] <- paste(mdf_reshaped_i_temp$mes)
mdf_reshaped_i_temp <- mdf_reshaped_i_temp %>% select(-c(mes))
mdf_reshaped_i_spo2 <- subset(mdf_reshaped_i, grepl("spo2", mdf_reshaped_i$mes)) # SpO2
names(mdf_reshaped_i_spo2)[5] <- paste(mdf_reshaped_i_spo2$mes)
mdf_reshaped_i_spo2 <- mdf_reshaped_i_spo2 %>% select(-c(mes))
mdf_reshaped_i_o2 <- subset(mdf_reshaped_i, grepl("_o2", mdf_reshaped_i$mes)) # O2
names(mdf_reshaped_i_o2)[5] <- paste(mdf_reshaped_i_o2$mes)
mdf_reshaped_i_o2 <- mdf_reshaped_i_o2 %>% select(-c(mes))
mdf_reshaped_i_pr <- subset(mdf_reshaped_i, grepl("pr", mdf_reshaped_i$mes)) # PR
names(mdf_reshaped_i_pr)[5] <- paste(mdf_reshaped_i_pr$mes)
mdf_reshaped_i_pr <- mdf_reshaped_i_pr %>% select(-c(mes))
mdf_reshaped_i_pi <- subset(mdf_reshaped_i, grepl("pi", mdf_reshaped_i$mes)) # PI
names(mdf_reshaped_i_pi)[5] <- paste(mdf_reshaped_i_pi$mes)
mdf_reshaped_i_pi <- mdf_reshaped_i_pi %>% select(-c(mes))
mdf_reshaped_i_rr <- subset(mdf_reshaped_i, grepl("rr", mdf_reshaped_i$mes)) # RR
names(mdf_reshaped_i_rr)[5] <- paste(mdf_reshaped_i_rr$mes)
mdf_reshaped_i_rr <- mdf_reshaped_i_rr %>% select(-c(mes))
## Join back to one df for recreation of full df
mdf_reshaped_i <- left_join(mdf_reshaped_i_temp, mdf_reshaped_i_o2, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_i <- left_join(mdf_reshaped_i, mdf_reshaped_i_spo2, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_i <- left_join(mdf_reshaped_i, mdf_reshaped_i_pr, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_i <- left_join(mdf_reshaped_i, mdf_reshaped_i_pi, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_i <- left_join(mdf_reshaped_i, mdf_reshaped_i_rr, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
## Do all of the above for reference measurements
mdf_reshaped_r <- subset(mdf_reshaped, grepl("ref", mdf_reshaped$mes))
mdf_reshaped_r_temp <- subset(mdf_reshaped_r, grepl("temp", mdf_reshaped_r$mes)) # Temp
names(mdf_reshaped_r_temp)[5] <- paste(mdf_reshaped_r_temp$mes)
mdf_reshaped_r_temp <- mdf_reshaped_r_temp %>% select(-c(mes))
mdf_reshaped_r_spo2 <- subset(mdf_reshaped_r, grepl("sp02", mdf_reshaped_r$mes)) # SpO2
names(mdf_reshaped_r_spo2)[5] <- paste(mdf_reshaped_r_spo2$mes)
mdf_reshaped_r_spo2 <- mdf_reshaped_r_spo2 %>% select(-c(mes))
mdf_reshaped_r_o2 <- subset(mdf_reshaped_r, grepl("_o2", mdf_reshaped_r$mes)) # O2
names(mdf_reshaped_r_o2)[5] <- paste(mdf_reshaped_r_o2$mes)
mdf_reshaped_r_o2 <- mdf_reshaped_r_o2 %>% select(-c(mes))
mdf_reshaped_r_pr <- subset(mdf_reshaped_r, grepl("pr", mdf_reshaped_r$mes)) # PR
names(mdf_reshaped_r_pr)[5] <- paste(mdf_reshaped_r_pr$mes)
mdf_reshaped_r_pr <- mdf_reshaped_r_pr %>% select(-c(mes))
mdf_reshaped_r_pi <- subset(mdf_reshaped_r, grepl("pi", mdf_reshaped_r$mes)) # PI
names(mdf_reshaped_r_pi)[5] <- paste(mdf_reshaped_r_pi$mes)
mdf_reshaped_r_pi <- mdf_reshaped_r_pi %>% select(-c(mes))
mdf_reshaped_r_rr <- subset(mdf_reshaped_r, grepl("rr", mdf_reshaped_r$mes)) # RR
names(mdf_reshaped_r_rr)[5] <- paste(mdf_reshaped_r_rr$mes)
mdf_reshaped_r_rr <- mdf_reshaped_r_rr %>% select(-c(mes))
## Join back to one df for recreation of full df
mdf_reshaped_r <- left_join(mdf_reshaped_r_temp, mdf_reshaped_r_o2, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_r <- left_join(mdf_reshaped_r, mdf_reshaped_r_spo2, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_r <- left_join(mdf_reshaped_r, mdf_reshaped_r_pr, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_r <- left_join(mdf_reshaped_r, mdf_reshaped_r_pi, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
mdf_reshaped_r <- left_join(mdf_reshaped_r, mdf_reshaped_r_rr, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp"))
# Join index and ref df's back to one melted df
mdf_reshaped <- left_join(mdf_reshaped_i, mdf_reshaped_r, by = c("ppt_id", "index_device_name", "age_months", "age_cat", "grp")) #long format df w/index & ref measurements for all devices & measurement types

# Add indicator variables here for clinical thresholds (long format) -- Note: From the SAP, these are defined for the user in Section 5, if changed here be sure to change there and below
mdf_reshaped$index_hypoxic <- ifelse(mdf_reshaped$index_o2<90, 1, 0)
mdf_reshaped$ref_hypoxic <- ifelse(mdf_reshaped$ref_o2<90, 1, 0)
mdf_reshaped$index_fever <- ifelse(mdf_reshaped$index_temp>37, 1, 0)
mdf_reshaped$ref_fever <- ifelse(mdf_reshaped$ref_temp>37, 1, 0)
mdf_reshaped$index_fastbreath_12mo <- ifelse(mdf_reshaped$index_rr>49 & mdf_reshaped$age_months<12, 1, 0)
mdf_reshaped$ref_fastbreath_12mo <- ifelse(mdf_reshaped$ref_rr>49 & mdf_reshaped$age_months<12, 1, 0)
mdf_reshaped$index_fastbreath_35mo <- ifelse(mdf_reshaped$index_rr>39 & (mdf_reshaped$age_months>11 & mdf_reshaped$age_months<36), 1, 0)
mdf_reshaped$ref_fastbreath_35mo <- ifelse(mdf_reshaped$ref_rr>39 & (mdf_reshaped$age_months>11 & mdf_reshaped$age_months<36), 1, 0)
mdf_reshaped$index_fastbreath_59mo <- ifelse(mdf_reshaped$index_rr>29 & (mdf_reshaped$age_months>35 & mdf_reshaped$age_months<60), 1, 0)
mdf_reshaped$ref_fastbreath_59mo <- ifelse(mdf_reshaped$ref_rr>29 & (mdf_reshaped$age_months>35 & mdf_reshaped$age_months<60), 1, 0)
mdf_reshaped$index_tachycardic_12mo <- ifelse(mdf_reshaped$index_pr>179 & mdf_reshaped$age_months<12, 1, 0)
mdf_reshaped$ref_tachycardic_12mo <- ifelse(mdf_reshaped$ref_pr>179 & mdf_reshaped$age_months<12, 1, 0)
mdf_reshaped$index_tachycardic_59mo <- ifelse(mdf_reshaped$index_pr>139 & mdf_reshaped$age_months>11, 1, 0)
mdf_reshaped$ref_tachycardic_59mo <- ifelse(mdf_reshaped$ref_pr>139 & mdf_reshaped$age_months>11, 1, 0)
# Add clinical age categories for fast breathing and tachycardic
mdf_reshaped$age_cat_tachy <- ifelse(mdf_reshaped$age_months<12, "0-11 months", "12-59 months")
mdf_reshaped$age_cat_fastbreathe <- case_when(mdf_reshaped$age_months<12 ~ "0-11 months",
                                              mdf_reshaped$age_months>11 & mdf_reshaped$age_months<36 ~ "12-35 months",
                                              mdf_reshaped$age_months>35 ~ "36-59 months")
mdf_reshaped$grp <- as.factor(mdf_reshaped$grp)
```

```{r device_dfs}
# --- SECTION 2: CREATING DEVICE DF'S
# Create a df for each device (in both wide and long format) -- note: any variable formatting (e.g., converting to factors) or additional variable creation should happen prior to creating these little dataframes

## Long format (M1-M3 are levels of one variable)
df_radg_l <- subset(mdf_reshaped, index_device_name=="Rad-G Temp (Masimo)")
df_radg_cat1_l <- subset(df_radg_l, age_cat=="1")
df_radg_cat2_l <- subset(df_radg_l, age_cat=="2")
df_radg_cat3_l <- subset(df_radg_l, age_cat=="3")
df_radg_cat1tachy_l <- subset(df_radg_l, age_cat_tachy=="0-11 months")
df_radg_cat2tachy_l <- subset(df_radg_l, age_cat_tachy=="12-59 months")
df_radg_cat1fb_l <- subset(df_radg_l, age_cat_fastbreathe=="0-11 months")
df_radg_cat2fb_l <- subset(df_radg_l, age_cat_fastbreathe=="12-35 months")
df_radg_cat3fb_l <- subset(df_radg_l, age_cat_fastbreathe=="36-59 months")

df_bio_l <- subset(mdf_reshaped, index_device_name=="m800 (Biolight)")
df_bio_cat1_l <- subset(df_bio_l, age_cat=="1")
df_bio_cat2_l <- subset(df_bio_l, age_cat=="2")
df_bio_cat3_l <- subset(df_bio_l, age_cat=="3")
df_bio_cat1tachy_l <- subset(df_bio_l, age_cat_tachy=="0-11 months")
df_bio_cat2tachy_l <- subset(df_bio_l, age_cat_tachy=="12-59 months")
df_bio_cat1fb_l <- subset(df_bio_l, age_cat_fastbreathe=="0-11 months")
df_bio_cat2fb_l <- subset(df_bio_l, age_cat_fastbreathe=="12-35 months")
df_bio_cat3fb_l <- subset(df_bio_l, age_cat_fastbreathe=="36-59 months")

df_neo_l <- subset(mdf_reshaped, index_device_name=="NeoGuard (Neopenda)")
df_neo_cat1_l <- subset(df_neo_l, age_cat=="1")
df_neo_cat2_l <- subset(df_neo_l, age_cat=="2")
df_neo_cat3_l <- subset(df_neo_l, age_cat=="3")
df_neo_cat1tachy_l <- subset(df_neo_l, age_cat_tachy=="0-11 months")
df_neo_cat2tachy_l <- subset(df_neo_l, age_cat_tachy=="12-59 months")
df_neo_cat1fb_l <- subset(df_neo_l, age_cat_fastbreathe=="0-11 months")
df_neo_cat2fb_l <- subset(df_neo_l, age_cat_fastbreathe=="12-35 months")
df_neo_cat3fb_l <- subset(df_neo_l, age_cat_fastbreathe=="36-59 months")

df_onyx_l <- subset(mdf_reshaped, index_device_name=="Onyx PO+RR (Nonin)")
df_onyx_cat3_l <- subset(df_onyx_l, age_cat=="3")
df_onyx_cat2tachy_l <- subset(df_onyx_l, age_cat_tachy=="12-59 months")
df_onyx_cat2fb_l <- subset(df_onyx_l, age_cat_fastbreathe=="12-35 months")
df_onyx_cat3fb_l <- subset(df_onyx_l, age_cat_fastbreathe=="36-59 months")

df_scan_l <- subset(mdf_reshaped, index_device_name=="Scanbo v8 (Scanbo)")
df_scan_cat3_l <- subset(df_scan_l, age_cat=="3")
df_scan_cat2tachy_l <- subset(df_scan_l, age_cat_tachy=="12-59 months")
df_scan_cat2fb_l <- subset(df_scan_l, age_cat_fastbreathe=="12-35 months")
df_scan_cat3fb_l <- subset(df_scan_l, age_cat_fastbreathe=="36-59 months")

# Add indicator variables here for clinical thresholds (wide format), each measurement -- Note: From the SAP, these are defined for the user in Section 5, if changed here be sure to change there and above
## M1
df_og$m1_index_hypoxic <- ifelse(df_og$m1_index_o2<90, 1, 0)
df_og$m1_ref_hypoxic <- ifelse(df_og$m1_ref_o2<90, 1, 0)
df_og$m1_index_fever <- ifelse(df_og$m1_index_temp>37, 1, 0)
df_og$m1_ref_fever <- ifelse(df_og$m1_therm_skin_temp>37, 1, 0)
df_og$m1_index_fastbreath_12mo <- ifelse(df_og$m1_index_rr>49 & df_og$age_months<12, 1, 0)
df_og$m1_ref_fastbreath_12mo <- ifelse(df_og$m1_ref_rracoustic>49 & df_og$age_months<12, 1, 0)
df_og$m1_index_fastbreath_35mo <- ifelse(df_og$m1_index_rr>39 & (df_og$age_months>11 & df_og$age_months<36), 1, 0)
df_og$m1_ref_fastbreath_35mo <- ifelse(df_og$m1_ref_rracoustic>39 & (df_og$age_months>11 & df_og$age_months<36), 1, 0)
df_og$m1_index_fastbreath_59mo <- ifelse(df_og$m1_index_rr>29 & (df_og$age_months>35 & df_og$age_months<60), 1, 0)
df_og$m1_ref_fastbreath_59mo <- ifelse(df_og$m1_ref_rracoustic>29 & (df_og$age_months>35 & df_og$age_months<60), 1, 0)
df_og$m1_index_tachycardic_12mo <- ifelse(df_og$m1_index_pr>179 & df_og$age_months<12, 1, 0)
df_og$m1_ref_tachycardic_12mo <- ifelse(df_og$m1_ref_pr>179 & df_og$age_months<12, 1, 0)
df_og$m1_index_tachycardic_59mo <- ifelse(df_og$m1_index_pr>139 & df_og$age_months>11, 1, 0)
df_og$m1_ref_tachycardic_59mo <- ifelse(df_og$m1_ref_pr>139 & df_og$age_months>11, 1, 0)
## M2
df_og$m2_index_hypoxic <- ifelse(df_og$m2_index_o2<90, 1, 0)
df_og$m2_ref_hypoxic <- ifelse(df_og$m2_ref_o2<90, 1, 0)
df_og$m2_index_fever <- ifelse(df_og$m2_index_temp>37, 1, 0)
df_og$m2_ref_fever <- ifelse(df_og$m2_therm_skin_temp>37, 1, 0)
df_og$m2_index_fastbreath_12mo <- ifelse(df_og$m2_index_rr>49 & df_og$age_months<12, 1, 0)
df_og$m2_ref_fastbreath_12mo <- ifelse(df_og$m2_ref_rracoustic>49 & df_og$age_months<12, 1, 0)
df_og$m2_index_fastbreath_35mo <- ifelse(df_og$m2_index_rr>39 & (df_og$age_months>11 & df_og$age_months<36), 1, 0)
df_og$m2_ref_fastbreath_35mo <- ifelse(df_og$m2_ref_rracoustic>39 & (df_og$age_months>11 & df_og$age_months<36), 1, 0)
df_og$m2_index_fastbreath_59mo <- ifelse(df_og$m2_index_rr>29 & (df_og$age_months>35 & df_og$age_months<60), 1, 0)
df_og$m2_ref_fastbreath_59mo <- ifelse(df_og$m2_ref_rracoustic>29 & (df_og$age_months>35 & df_og$age_months<60), 1, 0)
df_og$m2_index_tachycardic_12mo <- ifelse(df_og$m2_index_pr>179 & df_og$age_months<12, 1, 0)
df_og$m2_ref_tachycardic_12mo <- ifelse(df_og$m2_ref_pr>179 & df_og$age_months<12, 1, 0)
df_og$m2_index_tachycardic_59mo <- ifelse(df_og$m2_index_pr>139 & df_og$age_months>11, 1, 0)
df_og$m2_ref_tachycardic_59mo <- ifelse(df_og$m2_ref_pr>139 & df_og$age_months>11, 1, 0)
## M3
df_og$m3_index_hypoxic <- ifelse(df_og$m3_index_o2<90, 1, 0)
df_og$m3_ref_hypoxic <- ifelse(df_og$m3_ref_o2<90, 1, 0)
df_og$m3_index_fever <- ifelse(df_og$m3_index_temp>37, 1, 0)
df_og$m3_ref_fever <- ifelse(df_og$m3_therm_skin_temp>37, 1, 0)
df_og$m3_index_fastbreath_12mo <- ifelse(df_og$m3_index_rr>49 & df_og$age_months<12, 1, 0)
df_og$m3_ref_fastbreath_12mo <- ifelse(df_og$m3_ref_rracoustic>49 & df_og$age_months<12, 1, 0)
df_og$m3_index_fastbreath_35mo <- ifelse(df_og$m3_index_rr>39 & (df_og$age_months>11 & df_og$age_months<36), 1, 0)
df_og$m3_ref_fastbreath_35mo <- ifelse(df_og$m3_ref_rracoustic>39 & (df_og$age_months>11 & df_og$age_months<36), 1, 0)
df_og$m3_index_fastbreath_59mo <- ifelse(df_og$m3_index_rr>29 & (df_og$age_months>35 & df_og$age_months<60), 1, 0)
df_og$m3_ref_fastbreath_59mo <- ifelse(df_og$m3_ref_rracoustic>29 & (df_og$age_months>35 & df_og$age_months<60), 1, 0)
df_og$m3_index_tachycardic_12mo <- ifelse(df_og$m3_index_pr>179 & df_og$age_months<12, 1, 0)
df_og$m3_ref_tachycardic_12mo <- ifelse(df_og$m3_ref_pr>179 & df_og$age_months<12, 1, 0)
df_og$m3_index_tachycardic_59mo <- ifelse(df_og$m3_index_pr>139 & df_og$age_months>11, 1, 0)
df_og$m3_ref_tachycardic_59mo <- ifelse(df_og$m3_ref_pr>139 & df_og$age_months>11, 1, 0)
# Add clinical age categories for fast breathing and tachycardic
df_og$age_cat_tachy <- ifelse(df_og$age_months<12, "0-11 months", "12-59 months")
df_og$age_cat_fastbreathe <- case_when(df_og$age_months<12 ~ "0-11 months",
                                        df_og$age_months>11 & df_og$age_months<36 ~ "12-35 months",
                                        df_og$age_months>35 ~ "36-59 months")

## Wide format device df's (M1-M3 are variables)
df_radg_w <- subset(df_og, index_device_name=="Rad-G Temp (Masimo)")
df_radg_cat1_w <- subset(df_radg_w, age_cat=="1")
df_radg_cat2_w <- subset(df_radg_w, age_cat=="2")
df_radg_cat3_w <- subset(df_radg_w, age_cat=="3")
df_radg_cat1tachy_w <- subset(df_radg_w, age_cat_tachy=="0-11 months")
df_radg_cat2tachy_w <- subset(df_radg_w, age_cat_tachy=="12-59 months")
df_radg_cat1fb_w <- subset(df_radg_w, age_cat_fastbreathe=="0-11 months")
df_radg_cat2fb_w <- subset(df_radg_w, age_cat_fastbreathe=="12-35 months")
df_radg_cat3fb_w <- subset(df_radg_w, age_cat_fastbreathe=="36-59 months")

df_bio_w <- subset(df_og, index_device_name=="m800 (Biolight)")
df_bio_cat1_w <- subset(df_bio_w, age_cat=="1")
df_bio_cat2_w <- subset(df_bio_w, age_cat=="2")
df_bio_cat3_w <- subset(df_bio_w, age_cat=="3")
df_bio_cat1tachy_w <- subset(df_bio_w, age_cat_tachy=="0-11 months")
df_bio_cat2tachy_w <- subset(df_bio_w, age_cat_tachy=="12-59 months")
df_bio_cat1fb_w <- subset(df_bio_w, age_cat_fastbreathe=="0-11 months")
df_bio_cat2fb_w <- subset(df_bio_w, age_cat_fastbreathe=="12-35 months")
df_bio_cat3fb_w <- subset(df_bio_w, age_cat_fastbreathe=="36-59 months")

df_neo_w <- subset(df_og, index_device_name=="NeoGuard (Neopenda)")
df_neo_cat1_w <- subset(df_neo_w, age_cat=="1")
df_neo_cat2_w <- subset(df_neo_w, age_cat=="2")
df_neo_cat3_w <- subset(df_neo_w, age_cat=="3")
df_neo_cat1tachy_w <- subset(df_neo_w, age_cat_tachy=="0-11 months")
df_neo_cat2tachy_w <- subset(df_neo_w, age_cat_tachy=="12-59 months")
df_neo_cat1fb_w <- subset(df_neo_w, age_cat_fastbreathe=="0-11 months")
df_neo_cat2fb_w <- subset(df_neo_w, age_cat_fastbreathe=="12-35 months")
df_neo_cat3fb_w <- subset(df_neo_w, age_cat_fastbreathe=="36-59 months")

df_onyx_w <- subset(df_og, index_device_name=="Onyx PO+RR (Nonin)")
df_onyx_cat3_w <- subset(df_onyx_w, age_cat=="3")
df_onyx_cat2tachy_w <- subset(df_onyx_w, age_cat_tachy=="12-59 months")
df_onyx_cat2fb_w <- subset(df_onyx_w, age_cat_fastbreathe=="12-35 months")
df_onyx_cat3fb_w <- subset(df_onyx_w, age_cat_fastbreathe=="36-59 months")

df_scan_w <- subset(df_og, index_device_name=="Scanbo v8 (Scanbo)")
df_scan_cat3_w <- subset(df_scan_w, age_cat=="3")
df_scan_cat2tachy_w <- subset(df_scan_w, age_cat_tachy=="12-59 months")
df_scan_cat2fb_w <- subset(df_scan_w, age_cat_fastbreathe=="12-35 months")
df_scan_cat3fb_w <- subset(df_scan_w, age_cat_fastbreathe=="36-59 months")
```



This report contains data from **`r COUNTRY`**.

# Section 1: Participant Characteristics {.tabset}
Leila

## Table 1: Participant Characteristics Overall and by Facility

```{r include = FALSE}

# @ Leila and team - would recommend using the cleaned check box variables (have been added to the codebook), also just an fyi that you don't need to explicitly create factored variables for the CreateTableOne to treat them as categorical, as long as they're included in your factorVars list they'll be handled as categorical even if they're numeric

# Specify all the variables you want to treat as factors

factorVars <- c("age_cat", "sex","cg_relationship", 
                "visit_rsn_illness", "visit_rsn_immunize", "visit_rsn_routine", "visit_rsn_trauma", "visit_rsn_admit",
                "ill_sxs_cough", "ill_sxs_rapidbreathing", "ill_sxs_fever",
                "ill_sxs_diarrhea", "ill_sxs_vomit", "ill_sxs_other",
                "received_dx", "dx_dehydration", "dx_respiratory", "dx_digestive", "dx_malaria",
                "dx_fever", "dx_measles", "dx_earinfection", "dx_throatinfection", "dx_other",
                "received_tx", "tx_antibiotic", "tx_antimalarial", "tx_dehydration", "tx_bronchodilator",
                "tx_other")

# Create 3 new variables for the mean of the reference spo2, pr, and temp across all 3 measurements per row in order to compute summary 

df_og <- df_og %>% 
  mutate(mean_ref_spo2 = rowMeans(select(df_og, c(m1_ref_o2, m2_ref_o2, m3_ref_o2)),
                                  na.rm = TRUE)) %>% 
  mutate(mean_ref_pr = rowMeans(select(df_og, c(m1_ref_pr, m2_ref_pr, m3_ref_pr)),
                                na.rm = TRUE)) %>%
  mutate(mean_ref_temp = rowMeans(select(df_og, c(m1_therm_skin_temp, m2_therm_skin_temp, m3_therm_skin_temp)),
                                  na.rm = TRUE))

# Specify the continuous variables

contVars <- c("height", "weight", "muac", "hemocue_hb", "head_circumference", "mean_ref_spo2", "mean_ref_pr", "mean_ref_temp")

# Specify all the variables to include in table 1 (both continuous and categorical)

myVars <- c("age_cat", "sex","cg_relationship", 
            "visit_rsn_illness", "visit_rsn_immunize", "visit_rsn_routine", "visit_rsn_trauma", "visit_rsn_admit",
            "ill_sxs_cough", "ill_sxs_rapidbreathing", "ill_sxs_fever",
            "ill_sxs_diarrhea", "ill_sxs_vomit", "ill_sxs_other",
            "received_dx", "dx_dehydration", "dx_respiratory", "dx_digestive", "dx_malaria",
            "dx_fever", "dx_measles", "dx_earinfection", "dx_throatinfection", "dx_other",
            "received_tx", "tx_antibiotic", "tx_antimalarial", "tx_dehydration", "tx_bronchodilator",
            "tx_other", "height", "weight", "muac", "hemocue_hb", "head_circumference", "mean_ref_spo2", "mean_ref_pr", "mean_ref_temp")

# CreateTableOne Overall:

out1 <- CreateTableOne(vars = myVars,
               data = df_og,
               factorVars = factorVars,
               strata = "facility_name",
               test = FALSE,
               addOverall = TRUE)

t1_overall <- print(out1,
            cramVars = "sex")

# CreateTableOne stratified by facility -- RG Note: I added a parameter to the object above so you don't need to create a second object

out2 <- CreateTableOne(vars = myVars,
               data = df_og,
               factorVars = factorVars,
               strata = "facility_name",
               test = FALSE)

t1_by_facility <- print(out2,
            cramVars = "sex")

# Summary statistics of the continuous variables

summary(out1$contTable) # RG Note: what is this meant to do?

# RG Suggestion: Since we'll be outputting to html (at least to start), see if you can get it to output as an html table when you knit the document. You may also want to add rownames to make the output more intuitive to the reader (e.g., define what cg_relationship 1-10 actually means). Here's some sample code to get you started:

# suggest releveling age category to appear in order

# t1lab <- c("N", "Age Category", "0-1 month")
# rownames(t1_overall) <- c(t1lab)

t1 <- kable(t1_overall) %>%
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") %>%
  add_indent(c(3:5))
```
`r t1`

## List of free responses entered for 'other' fields {.tabset}

### Symptoms
```{r}
df_og[df_og$ill_sxs_other==1,c("ppt_id", "visit_reason_ill_sxs_oth")]
```
### Diagnosis
```{r}
df_og[df_og$dx_other==1,c("ppt_id", "reported_dx_oth")]
```
### Treatment
```{r}
df_og[df_og$tx_other==1,c("ppt_id", "reported_tx_oth")]
```

# Section 2: Measurement Characteristics & Precision {.tabset}
Leila

## Reference
```{r, include=FALSE}

```

## Rad-G Temp (Masimo)


## m800 (Biolight)


## NeoGuard (Neopenda)


## Onyx PO+RR (Nonin)


## Scanbo v8 (Scanbo)


# Section 3: Bland Altman Plots {.tabset}
Anmol

```{r}
# @Anmol - I think I found a solution to get all the measurements on one plot...it required reshaping the data, which I added to the beginning prep section of the document. There are now both long and wide formats of the data, and if we use the long format for the plots and switch the graphical system to base instead of ggplot, it seems like it will work -- see Rad-G code below
```

## Rad-G Temp (Masimo) {.tabset}

### Temperature
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat1_l$ref_temp, df_radg_cat1_l$index_temp, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Temperature (0-1 month)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat1_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat2_l$ref_temp, df_radg_cat2_l$index_temp, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Temperature (2-11 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat2_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat3_l$ref_temp, df_radg_cat3_l$index_temp, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Temperature (12-59 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat3_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```

### Oxygen
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat1_l$ref_o2, df_radg_cat1_l$index_o2, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G O2 (0-1 month)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat1_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat2_l$ref_o2, df_radg_cat2_l$index_o2, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G O2 (2-11 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat2_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat3_l$ref_o2, df_radg_cat3_l$index_o2, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G O2 (12-59 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat3_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```

### Profusion Index
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat1_l$ref_pi, df_radg_cat1_l$index_pi, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Profusion Index (0-1 month)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat1_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat2_l$ref_pi, df_radg_cat2_l$index_pi, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Profusion Index (2-11 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat2_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat3_l$ref_pi, df_radg_cat3_l$index_pi, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Profusion Index (12-59 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat3_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```

### Pulse Rate
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat1_l$ref_pr, df_radg_cat1_l$index_pr, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Pulse Rate (0-1 month)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat1_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat2_l$ref_pr, df_radg_cat2_l$index_pr, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Pulse Rate (2-11 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat2_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```
```{r, results='hide', fig.keep='last'}
bland.altman.plot(df_radg_cat3_l$ref_pr, df_radg_cat3_l$index_pr, graph.sys = "base", xlab = "Means", ylab = "Differences", main = "Bland-Altman Plot: Rad-G Pulse Rate (12-59 months)", col = c("black", "#EB6864", "#777777"), pch=19)
legend("topleft", legend = levels(df_radg_cat3_l$grp), col = c("black", "#EB6864", "#777777"), pch = 19)
```

### Respiratory Rate -- this will only have one plot per age group using the matched index measurement to what was annotated

## m800 (Biolight) {.tabset}
```{r, include=FALSE}

```

### Oxygen

### Pulse Rate

### Respiratory Rate -- this will only have one plot per age group using the matched index measurement to what was annotated

## NeoGuard (Neopenda) {.tabset}
```{r, include=FALSE}

```

### Temperature

### Oxygen

### Pulse Rate

### Respiratory Rate -- this will only have one plot per age group using the matched index measurement to what was annotated

## Onyx PO+RR (Nonin) {.tabset}
```{r, include=FALSE}

```

## Scanbo v8 (Scanbo) {.tabset}
```{r, include=FALSE}

```

### Temperature

### Oxygen

### Pulse Rate

### Respiratory Rate -- this will only have one plot per age group using the matched index measurement to what was annotated

# Section 4: Intraclass Correlation Coefficients {.tabset}
Reporting information:

- Model: Two-way mixed effects [NOTE: no functional difference between 2-way random and mixed effects...seems the difference is more conceptual than mathematical but should confirm w/Laina]
  - Justification: Repeated measurements cannot be considered random samples.
- Type: Single measurement
  - Justification: In clinical practice, a single measurement rather than the mean of multiple measurements is considered as the unit of analysis.
- Definition: Absolute agreement
  - Justification: This is the only appropriate definition for a test-retest analysis, as the device of interest would be meaningless without agreement between repeated measures.

How to interpret the ICC:

-	<0.5: Poor reliability
-	0.5<0.75: Moderate reliability
-	0.75<0.9: Good reliability
-	≥0.9: Excellent reliability

```{r, include=FALSE}
# Create M1-3 matrices by age category, device, and measurement type

# -- Rad-G
## Rad-G, Age Cat 1
df_radg_cat1_temp <- df_radg_cat1_w %>% select(colnames(df_radg_cat1_w[grepl("+index_temp", names(df_radg_cat1_w))]))
df_radg_cat1_o2 <- df_radg_cat1_w %>% select(colnames(df_radg_cat1_w[grepl("+index_o2", names(df_radg_cat1_w))]))
df_radg_cat1_pi <- df_radg_cat1_w %>% select(colnames(df_radg_cat1_w[grepl("+index_pi", names(df_radg_cat1_w))]))
df_radg_cat1_pr <- df_radg_cat1_w %>% select(colnames(df_radg_cat1_w[grepl("+index_pr", names(df_radg_cat1_w))]))
df_radg_cat1_rr <- df_radg_cat1_w %>% select(colnames(df_radg_cat1_w[grepl("+index_rr", names(df_radg_cat1_w))]))
## Rad-G, Age Cat 2
df_radg_cat2_temp <- df_radg_cat2_w %>% select(colnames(df_radg_cat2_w[grepl("+index_temp", names(df_radg_cat2_w))]))
df_radg_cat2_o2 <- df_radg_cat2_w %>% select(colnames(df_radg_cat2_w[grepl("+index_o2", names(df_radg_cat2_w))]))
df_radg_cat2_pi <- df_radg_cat2_w %>% select(colnames(df_radg_cat2_w[grepl("+index_pi", names(df_radg_cat2_w))]))
df_radg_cat2_pr <- df_radg_cat2_w %>% select(colnames(df_radg_cat2_w[grepl("+index_pr", names(df_radg_cat2_w))]))
df_radg_cat2_rr <- df_radg_cat2_w %>% select(colnames(df_radg_cat2_w[grepl("+index_rr", names(df_radg_cat2_w))]))
## Rad-G, Age Cat 3
df_radg_cat3_temp <- df_radg_cat3_w %>% select(colnames(df_radg_cat3_w[grepl("+index_temp", names(df_radg_cat3_w))]))
df_radg_cat3_o2 <- df_radg_cat3_w %>% select(colnames(df_radg_cat3_w[grepl("+index_o2", names(df_radg_cat3_w))]))
df_radg_cat3_pi <- df_radg_cat3_w %>% select(colnames(df_radg_cat3_w[grepl("+index_pi", names(df_radg_cat3_w))]))
df_radg_cat3_pr <- df_radg_cat3_w %>% select(colnames(df_radg_cat3_w[grepl("+index_pr", names(df_radg_cat3_w))]))
df_radg_cat3_rr <- df_radg_cat3_w %>% select(colnames(df_radg_cat3_w[grepl("+index_rr", names(df_radg_cat3_w))]))

# -- Biolight
## Biolight, Age Cat 1
df_bio_cat1_o2 <- df_bio_cat1_w %>% select(colnames(df_bio_cat1_w[grepl("+index_o2", names(df_bio_cat1_w))]))
df_bio_cat1_pr <- df_bio_cat1_w %>% select(colnames(df_bio_cat1_w[grepl("+index_pr", names(df_bio_cat1_w))]))
df_bio_cat1_rr <- df_bio_cat1_w %>% select(colnames(df_bio_cat1_w[grepl("+index_rr", names(df_bio_cat1_w))]))
## Biolight, Age Cat 2
df_bio_cat2_o2 <- df_bio_cat2_w %>% select(colnames(df_bio_cat2_w[grepl("+index_o2", names(df_bio_cat2_w))]))
df_bio_cat2_pr <- df_bio_cat2_w %>% select(colnames(df_bio_cat2_w[grepl("+index_pr", names(df_bio_cat2_w))]))
df_bio_cat2_rr <- df_bio_cat2_w %>% select(colnames(df_bio_cat2_w[grepl("+index_rr", names(df_bio_cat2_w))]))
## Biolight, Age Cat 3
df_bio_cat3_o2 <- df_bio_cat3_w %>% select(colnames(df_bio_cat3_w[grepl("+index_o2", names(df_bio_cat3_w))]))
df_bio_cat3_pr <- df_bio_cat3_w %>% select(colnames(df_bio_cat3_w[grepl("+index_pr", names(df_bio_cat3_w))]))
df_bio_cat3_rr <- df_bio_cat3_w %>% select(colnames(df_bio_cat3_w[grepl("+index_rr", names(df_bio_cat3_w))]))

# -- NeoGuard
## NeoGuard, Age Cat 1
df_neo_cat1_temp <- df_neo_cat1_w %>% select(colnames(df_neo_cat1_w[grepl("+index_temp", names(df_neo_cat1_w))]))
df_neo_cat1_o2 <- df_neo_cat1_w %>% select(colnames(df_neo_cat1_w[grepl("+index_o2", names(df_neo_cat1_w))]))
df_neo_cat1_pr <- df_neo_cat1_w %>% select(colnames(df_neo_cat1_w[grepl("+index_pr", names(df_neo_cat1_w))]))
df_neo_cat1_rr <- df_neo_cat1_w %>% select(colnames(df_neo_cat1_w[grepl("+index_rr", names(df_neo_cat1_w))]))
## NeoGuard, Age Cat 2
df_neo_cat2_temp <- df_neo_cat2_w %>% select(colnames(df_neo_cat2_w[grepl("+index_temp", names(df_neo_cat2_w))]))
df_neo_cat2_o2 <- df_neo_cat2_w %>% select(colnames(df_neo_cat2_w[grepl("+index_o2", names(df_neo_cat2_w))]))
df_neo_cat2_pr <- df_neo_cat2_w %>% select(colnames(df_neo_cat2_w[grepl("+index_pr", names(df_neo_cat2_w))]))
df_neo_cat2_rr <- df_neo_cat2_w %>% select(colnames(df_neo_cat2_w[grepl("+index_rr", names(df_neo_cat2_w))]))
## NeoGuard, Age Cat 3
df_neo_cat3_temp <- df_neo_cat3_w %>% select(colnames(df_neo_cat3_w[grepl("+index_temp", names(df_neo_cat3_w))]))
df_neo_cat3_o2 <- df_neo_cat3_w %>% select(colnames(df_neo_cat3_w[grepl("+index_o2", names(df_neo_cat3_w))]))
df_neo_cat3_pr <- df_neo_cat3_w %>% select(colnames(df_neo_cat3_w[grepl("+index_pr", names(df_neo_cat3_w))]))
df_neo_cat3_rr <- df_neo_cat3_w %>% select(colnames(df_neo_cat3_w[grepl("+index_rr", names(df_neo_cat3_w))]))

# -- Scanbo
## Scanbo, Age Cat 3
df_scan_cat3_temp <- df_scan_cat3_w %>% select(colnames(df_scan_cat3_w[grepl("+index_temp", names(df_scan_cat3_w))]))
df_scan_cat3_sp02 <- df_scan_cat3_w %>% select(colnames(df_scan_cat3_w[grepl("+index_sp02", names(df_scan_cat3_w))]))
df_scan_cat3_o2 <- df_scan_cat3_w %>% select(colnames(df_scan_cat3_w[grepl("+index_o2", names(df_scan_cat3_w))]))
df_scan_cat3_pr <- df_scan_cat3_w %>% select(colnames(df_scan_cat3_w[grepl("+index_pr", names(df_scan_cat3_w))]))
df_scan_cat3_rr <- df_scan_cat3_w %>% select(colnames(df_scan_cat3_w[grepl("+index_rr", names(df_scan_cat3_w))]))

# -- Onyx
## Onyx, Age Cat 3
df_onyx_cat3_o2 <- df_onyx_cat3_w %>% select(colnames(df_onyx_cat3_w[grepl("+index_o2", names(df_onyx_cat3_w))]))
df_onyx_cat3_pr <- df_onyx_cat3_w %>% select(colnames(df_onyx_cat3_w[grepl("+index_pr", names(df_onyx_cat3_w))]))
df_onyx_cat3_rr <- df_onyx_cat3_w %>% select(colnames(df_onyx_cat3_w[grepl("+index_rr", names(df_onyx_cat3_w))]))
```

```{r, include=FALSE}
# Create ICC objects for each age category, device, and measurement type

# Rad-G ICC objects
## Age Cat 1
icc_radg_cat1_temp <- icc(df_radg_cat1_temp, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat1_o2 <- icc(df_radg_cat1_o2, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat1_pi <- icc(df_radg_cat1_pi, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat1_pr <- icc(df_radg_cat1_pr, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat1_rr <- icc(df_radg_cat1_rr, model = "twoway", type = "agreement", unit = "single")
## Age Cat 2
icc_radg_cat2_temp <- icc(df_radg_cat2_temp, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat2_o2 <- icc(df_radg_cat2_o2, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat2_pi <- icc(df_radg_cat2_pi, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat2_pr <- icc(df_radg_cat2_pr, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat2_rr <- icc(df_radg_cat2_rr, model = "twoway", type = "agreement", unit = "single")
## Age Cat 3
icc_radg_cat3_temp <- icc(df_radg_cat3_temp, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat3_o2 <- icc(df_radg_cat3_o2, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat3_pi <- icc(df_radg_cat3_pi, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat3_pr <- icc(df_radg_cat3_pr, model = "twoway", type = "agreement", unit = "single")
icc_radg_cat3_rr <- icc(df_radg_cat3_rr, model = "twoway", type = "agreement", unit = "single")

# Biolight ICC objects
## Age Cat 1
icc_bio_cat1_o2 <- icc(df_bio_cat1_o2, model = "twoway", type = "agreement", unit = "single")
icc_bio_cat1_pr <- icc(df_bio_cat1_pr, model = "twoway", type = "agreement", unit = "single")
icc_bio_cat1_rr <- icc(df_bio_cat1_rr, model = "twoway", type = "agreement", unit = "single")
## Age Cat 2
icc_bio_cat2_o2 <- icc(df_bio_cat2_o2, model = "twoway", type = "agreement", unit = "single")
icc_bio_cat2_pr <- icc(df_bio_cat2_pr, model = "twoway", type = "agreement", unit = "single")
icc_bio_cat2_rr <- icc(df_bio_cat2_rr, model = "twoway", type = "agreement", unit = "single")
## Age Cat 3
icc_bio_cat3_o2 <- icc(df_bio_cat3_o2, model = "twoway", type = "agreement", unit = "single")
icc_bio_cat3_pr <- icc(df_bio_cat3_pr, model = "twoway", type = "agreement", unit = "single")
icc_bio_cat3_rr <- icc(df_bio_cat3_rr, model = "twoway", type = "agreement", unit = "single")

# NeoGuard ICC objects
## Age Cat 1
icc_neo_cat1_temp <- icc(df_neo_cat1_temp, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat1_o2 <- icc(df_neo_cat1_o2, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat1_pr <- icc(df_neo_cat1_pr, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat1_rr <- icc(df_neo_cat1_rr, model = "twoway", type = "agreement", unit = "single")
## Age Cat 2
icc_neo_cat2_temp <- icc(df_neo_cat2_temp, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat2_o2 <- icc(df_neo_cat2_o2, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat2_pr <- icc(df_neo_cat2_pr, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat2_rr <- icc(df_neo_cat2_rr, model = "twoway", type = "agreement", unit = "single")
## Age Cat 3
icc_neo_cat3_temp <- icc(df_neo_cat3_temp, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat3_o2 <- icc(df_neo_cat3_o2, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat3_pr <- icc(df_neo_cat3_pr, model = "twoway", type = "agreement", unit = "single")
icc_neo_cat3_rr <- icc(df_neo_cat3_rr, model = "twoway", type = "agreement", unit = "single")

# Scanbo ICC objects
## Age Cat 3
icc_scan_cat3_temp <- icc(df_scan_cat3_temp, model = "twoway", type = "agreement", unit = "single")
icc_scan_cat3_sp02 <- icc(df_scan_cat3_sp02, model = "twoway", type = "agreement", unit = "single")
icc_scan_cat3_o2 <- icc(df_scan_cat3_o2, model = "twoway", type = "agreement", unit = "single")
icc_scan_cat3_pr <- icc(df_scan_cat3_pr, model = "twoway", type = "agreement", unit = "single")
icc_scan_cat3_rr <- icc(df_scan_cat3_rr, model = "twoway", type = "agreement", unit = "single")

# Onyx ICC objects
## Age Cat 3
icc_onyx_cat3_o2 <- icc(df_onyx_cat3_o2, model = "twoway", type = "agreement", unit = "single")
icc_onyx_cat3_pr <- icc(df_onyx_cat3_pr, model = "twoway", type = "agreement", unit = "single")
icc_onyx_cat3_rr <- icc(df_onyx_cat3_rr, model = "twoway", type = "agreement", unit = "single")
```

```{r, include=FALSE}
# Build a table of ICC [95%CI] for each age category
# $value = icc point estimate; $lbound = lower bound of CI; $ubound = upper bound of CI

## Age Cat 1
out1 <- data.frame(cc = c("", "", "", "", "", "", "", "", "", ""),
                   radg = c(round(icc_radg_cat1_temp$value, 2), paste("(", round(icc_radg_cat1_temp$lbound, 2)," - ", round(icc_radg_cat1_temp$ubound, 2),")", sep = ""), 
                            round(icc_radg_cat1_o2$value, 2), paste("(", round(icc_radg_cat1_o2$lbound, 2)," - ", round(icc_radg_cat1_o2$ubound, 2),")", sep = ""), 
                            round(icc_radg_cat1_pi$value, 2), paste("(", round(icc_radg_cat1_pi$lbound, 2)," - ", round(icc_radg_cat1_pi$ubound, 2), ")", sep = ""),
                            round(icc_radg_cat1_pr$value, 2), paste("(", round(icc_radg_cat1_pr$lbound, 2) ," - ", round(icc_radg_cat1_pr$ubound, 2) ,")", sep = ""),
                            round(icc_radg_cat1_rr$value, 2), paste("(", round(icc_radg_cat1_rr$lbound, 2)," - ", round(icc_radg_cat1_rr$ubound, 2),")", sep = "")), 
                   bio = c(NA, NA,
                           round(icc_bio_cat1_o2$value, 2), paste("(", round(icc_bio_cat1_o2$lbound, 2)," - ", round(icc_bio_cat1_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_bio_cat1_pr$value, 2), paste("(", round(icc_bio_cat1_pr$lbound, 2), " - ", round(icc_bio_cat1_pr$ubound, 2),")", sep = ""),
                           round(icc_bio_cat1_rr$value, 2), paste("(", round(icc_bio_cat1_rr$lbound, 2) ," - ", round(icc_bio_cat1_rr$ubound, 2),")", sep = "")),
                   neo = c(round(icc_neo_cat1_temp$value, 2), paste("(", round(icc_neo_cat1_temp$lbound, 2)," - ", round(icc_neo_cat1_temp$ubound, 2), ")", sep = ""),
                           round(icc_neo_cat1_o2$value, 2), paste("(", round(icc_neo_cat1_o2$lbound, 2), " - ", round(icc_neo_cat1_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_neo_cat1_pr$value, 2), paste("(", round(icc_neo_cat1_pr$lbound, 2), " - ", round(icc_neo_cat1_pr$ubound, 2),")", sep = ""),
                           round(icc_neo_cat1_rr$value, 2), paste("(", round(icc_neo_cat1_rr$lbound, 2), " - ", round(icc_neo_cat1_rr$ubound, 2), ")", sep = "")))
icc_t1 <- kable(out1, col.names = c("","Rad-G Temp (Masimo)", "M800 (Biolight)", "NeoGuard (Neopenda)")) %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") %>%
  pack_rows("Temperature", 1, 2) %>%
  pack_rows("Oxygen", 3, 4) %>%
  pack_rows("Profusion Index", 5, 6) %>%
  pack_rows("Pulse Rate", 7, 8) %>%
  pack_rows("Respiratory Rate", 9, 10) %>%
  add_header_above(c(" ", "Intraclass correlation coefficient for clinical measures across devices for participantss aged 0-1 month (95%CI)" = 3))

# Age Cat 2
out2 <- data.frame(cc = c("", "", "", "", "", "", "", "", "", ""),
                   radg = c(round(icc_radg_cat2_temp$value, 2), paste("(", round(icc_radg_cat2_temp$lbound, 2)," - ", round(icc_radg_cat2_temp$ubound, 2),")", sep = ""), 
                            round(icc_radg_cat2_o2$value, 2), paste("(", round(icc_radg_cat2_o2$lbound, 2)," - ", round(icc_radg_cat2_o2$ubound, 2),")", sep = ""), 
                            round(icc_radg_cat2_pi$value, 2), paste("(", round(icc_radg_cat2_pi$lbound, 2)," - ", round(icc_radg_cat2_pi$ubound, 2), ")", sep = ""),
                            round(icc_radg_cat2_pr$value, 2), paste("(", round(icc_radg_cat2_pr$lbound, 2) ," - ", round(icc_radg_cat2_pr$ubound, 2) ,")", sep = ""),
                            round(icc_radg_cat2_rr$value, 2), paste("(", round(icc_radg_cat2_rr$lbound, 2)," - ", round(icc_radg_cat2_rr$ubound, 2),")", sep = "")), 
                   bio = c(NA, NA,
                           round(icc_bio_cat2_o2$value, 2), paste("(", round(icc_bio_cat2_o2$lbound, 2)," - ", round(icc_bio_cat2_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_bio_cat2_pr$value, 2), paste("(", round(icc_bio_cat2_pr$lbound, 2), " - ", round(icc_bio_cat2_pr$ubound, 2),")", sep = ""),
                           round(icc_bio_cat2_rr$value, 2), paste("(", round(icc_bio_cat2_rr$lbound, 2) ," - ", round(icc_bio_cat2_rr$ubound, 2),")", sep = "")),
                   neo = c(round(icc_neo_cat2_temp$value, 2), paste("(", round(icc_neo_cat2_temp$lbound, 2)," - ", round(icc_neo_cat2_temp$ubound, 2), ")", sep = ""),
                           round(icc_neo_cat2_o2$value, 2), paste("(", round(icc_neo_cat2_o2$lbound, 2), " - ", round(icc_neo_cat2_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_neo_cat2_pr$value, 2), paste("(", round(icc_neo_cat2_pr$lbound, 2), " - ", round(icc_neo_cat2_pr$ubound, 2),")", sep = ""),
                           round(icc_neo_cat2_rr$value, 2), paste("(", round(icc_neo_cat2_rr$lbound, 2), " - ", round(icc_neo_cat2_rr$ubound, 2), ")", sep = "")))
icc_t2 <- kable(out2, col.names = c("","Rad-G Temp (Masimo)", "M800 (Biolight)", "NeoGuard (Neopenda)")) %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") %>%
  pack_rows("Temperature", 1, 2) %>%
  pack_rows("Oxygen", 3, 4) %>%
  pack_rows("Profusion Index", 5, 6) %>%
  pack_rows("Pulse Rate", 7, 8) %>%
  pack_rows("Respiratory Rate", 9, 10) %>%
  add_header_above(c(" ", "Intraclass correlation coefficient for clinical measures across devices for participantss aged 2-11 months (95%CI)" = 3))

# Age Cat 3
out3 <- data.frame(cc = c("", "", "", "", "", "", "", "", "", ""),
                   radg = c(round(icc_radg_cat3_temp$value, 2), paste("(", round(icc_radg_cat3_temp$lbound, 2)," - ", round(icc_radg_cat3_temp$ubound, 2),")", sep = ""), 
                            round(icc_radg_cat3_o2$value, 2), paste("(", round(icc_radg_cat3_o2$lbound, 2)," - ", round(icc_radg_cat3_o2$ubound, 2),")", sep = ""), 
                            round(icc_radg_cat3_pi$value, 2), paste("(", round(icc_radg_cat3_pi$lbound, 2)," - ", round(icc_radg_cat3_pi$ubound, 2), ")", sep = ""),
                            round(icc_radg_cat3_pr$value, 2), paste("(", round(icc_radg_cat3_pr$lbound, 2) ," - ", round(icc_radg_cat3_pr$ubound, 2) ,")", sep = ""),
                            round(icc_radg_cat3_rr$value, 2), paste("(", round(icc_radg_cat3_rr$lbound, 2)," - ", round(icc_radg_cat3_rr$ubound, 2),")", sep = "")), 
                   bio = c(NA, NA,
                           round(icc_bio_cat3_o2$value, 2), paste("(", round(icc_bio_cat3_o2$lbound, 2)," - ", round(icc_bio_cat3_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_bio_cat3_pr$value, 2), paste("(", round(icc_bio_cat3_pr$lbound, 2), " - ", round(icc_bio_cat3_pr$ubound, 2),")", sep = ""),
                           round(icc_bio_cat3_rr$value, 2), paste("(", round(icc_bio_cat3_rr$lbound, 2) ," - ", round(icc_bio_cat3_rr$ubound, 2),")", sep = "")),
                   scan = c(round(icc_scan_cat3_temp$value, 2), paste("(", round(icc_scan_cat3_temp$lbound, 2)," - ", round(icc_scan_cat3_temp$ubound, 2), ")", sep = ""),
                           round(icc_scan_cat3_o2$value, 2), paste("(", round(icc_scan_cat3_o2$lbound, 2), " - ", round(icc_scan_cat3_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_scan_cat3_pr$value, 2), paste("(", round(icc_scan_cat3_pr$lbound, 2), " - ", round(icc_scan_cat3_pr$ubound, 2),")", sep = ""),
                           round(icc_scan_cat3_rr$value, 2), paste("(", round(icc_scan_cat3_rr$lbound, 2), " - ", round(icc_scan_cat3_rr$ubound, 2), ")", sep = "")),
                   onyx = c(NA, NA,
                           round(icc_onyx_cat3_o2$value, 2), paste("(", round(icc_onyx_cat3_o2$lbound, 2)," - ", round(icc_onyx_cat3_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_onyx_cat3_pr$value, 2), paste("(", round(icc_onyx_cat3_pr$lbound, 2), " - ", round(icc_onyx_cat3_pr$ubound, 2),")", sep = ""),
                           round(icc_onyx_cat3_rr$value, 2), paste("(", round(icc_onyx_cat3_rr$lbound, 2) ," - ", round(icc_onyx_cat3_rr$ubound, 2),")", sep = "")),
                   neo = c(round(icc_neo_cat3_temp$value, 2), paste("(", round(icc_neo_cat3_temp$lbound, 2)," - ", round(icc_neo_cat3_temp$ubound, 2), ")", sep = ""),
                           round(icc_neo_cat3_o2$value, 2), paste("(", round(icc_neo_cat3_o2$lbound, 2), " - ", round(icc_neo_cat3_o2$ubound, 2), ")", sep = ""),
                           NA, NA,
                           round(icc_neo_cat3_pr$value, 2), paste("(", round(icc_neo_cat3_pr$lbound, 2), " - ", round(icc_neo_cat3_pr$ubound, 2),")", sep = ""),
                           round(icc_neo_cat3_rr$value, 2), paste("(", round(icc_neo_cat3_rr$lbound, 2), " - ", round(icc_neo_cat3_rr$ubound, 2), ")", sep = "")))
icc_t3 <- kable(out3, col.names = c("","Rad-G Temp (Masimo)", "M800 (Biolight)", "Scanbo v8 (Scanbo)", "Onyx PO+RR (Nonin)", "NeoGuard (Neopenda)")) %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") %>%
  pack_rows("Temperature", 1, 2) %>%
  pack_rows("Oxygen", 3, 4) %>%
  pack_rows("Profusion Index", 5, 6) %>%
  pack_rows("Pulse Rate", 7, 8) %>%
  pack_rows("Respiratory Rate", 9, 10) %>%
  add_header_above(c(" ", "Intraclass correlation coefficient for clinical measures across devices for participantss aged 12-59 months (95%CI)" = 5))
```

## Table 3a
`r icc_t1`
## Table 3b
`r icc_t2`
## Table 3c
`r icc_t3`

# Section 5: Confusion Matrices {.tabset}
Samwel
Clinical thresholds used in the section are as follows:

- Hypoxemia: <90%
- Fast breathing: <12 months (>49 bpm); 12-35 months (>39 bpm); 36-60 months (>29 bpm)
- Tachycardia: <12 months (>179 bpm); 12-60 months (>139 bpm)
- Fever: >37C (≥100.4F)

*NOTE: Where different, clinical age categories are used in this section (and the next) in place of the study age categories.*

## Rad-G Temp (Masimo) {.tabset}
```{r, include=FALSE}
# create 2x2 table objects with margins to display (to display overall only)
# create 2x2 table objects with margins for each measurement number (for use in next section)
# these objects are needed for percent agreement calculation in next section, object naming convention follows device_clinicalmeasure# where # = age category
```

### Hypoxia
```{r}
# Long format (overall)
radg_hypoxia1 <- addmargins(table(df_radg_cat1_l$ref_hypoxic, df_radg_cat1_l$index_hypoxic))
rownames(radg_hypoxia1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_hypoxia1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-1 month**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

radg_hypoxia2 <- addmargins(table(df_radg_cat2_l$ref_hypoxic, df_radg_cat2_l$index_hypoxic))
rownames(radg_hypoxia2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_hypoxia2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**2-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

radg_hypoxia3 <- addmargins(table(df_radg_cat3_l$ref_hypoxic, df_radg_cat3_l$index_hypoxic))
rownames(radg_hypoxia3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_hypoxia3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

# Wide format, M1-3
radg_hypoxia1_m1 <- addmargins(table(df_radg_cat1_w$m1_ref_hypoxic, df_radg_cat1_w$m1_index_hypoxic))
radg_hypoxia1_m2 <- addmargins(table(df_radg_cat1_w$m2_ref_hypoxic, df_radg_cat1_w$m2_index_hypoxic))
radg_hypoxia1_m3 <- addmargins(table(df_radg_cat1_w$m3_ref_hypoxic, df_radg_cat1_w$m3_index_hypoxic))

radg_hypoxia2_m1 <- addmargins(table(df_radg_cat2_w$m1_ref_hypoxic, df_radg_cat2_w$m1_index_hypoxic))
radg_hypoxia2_m2 <- addmargins(table(df_radg_cat2_w$m2_ref_hypoxic, df_radg_cat2_w$m2_index_hypoxic))
radg_hypoxia2_m3 <- addmargins(table(df_radg_cat2_w$m3_ref_hypoxic, df_radg_cat2_w$m3_index_hypoxic))

radg_hypoxia3_m1 <- addmargins(table(df_radg_cat3_w$m1_ref_hypoxic, df_radg_cat3_w$m1_index_hypoxic))
radg_hypoxia3_m2 <- addmargins(table(df_radg_cat3_w$m2_ref_hypoxic, df_radg_cat3_w$m2_index_hypoxic))
radg_hypoxia3_m3 <- addmargins(table(df_radg_cat3_w$m3_ref_hypoxic, df_radg_cat3_w$m3_index_hypoxic))
```

### Fever
```{r}
# Long format (overall)
radg_fever1 <- addmargins(table(df_radg_cat1_l$ref_fever, df_radg_cat1_l$index_fever))
rownames(radg_fever1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_fever1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-1 month**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

radg_fever2 <- addmargins(table(df_radg_cat2_l$ref_fever, df_radg_cat2_l$index_fever))
rownames(radg_fever2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_fever2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**2-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

radg_fever3 <- addmargins(table(df_radg_cat3_l$ref_fever, df_radg_cat3_l$index_fever))
rownames(radg_fever3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_fever3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

# Wide format, M1-3
radg_fever1_m1 <- addmargins(table(df_radg_cat1_w$m1_ref_fever, df_radg_cat1_w$m1_index_fever))
radg_fever1_m2 <- addmargins(table(df_radg_cat1_w$m2_ref_fever, df_radg_cat1_w$m2_index_fever))
radg_fever1_m3 <- addmargins(table(df_radg_cat1_w$m3_ref_fever, df_radg_cat1_w$m3_index_fever))

radg_fever2_m1 <- addmargins(table(df_radg_cat2_w$m1_ref_fever, df_radg_cat2_w$m1_index_fever))
radg_fever2_m2 <- addmargins(table(df_radg_cat2_w$m2_ref_fever, df_radg_cat2_w$m2_index_fever))
radg_fever2_m3 <- addmargins(table(df_radg_cat2_w$m3_ref_fever, df_radg_cat2_w$m3_index_fever))

radg_fever3_m1 <- addmargins(table(df_radg_cat3_w$m1_ref_fever, df_radg_cat3_w$m1_index_fever))
radg_fever3_m2 <- addmargins(table(df_radg_cat3_w$m2_ref_fever, df_radg_cat3_w$m2_index_fever))
radg_fever3_m3 <- addmargins(table(df_radg_cat3_w$m3_ref_fever, df_radg_cat3_w$m3_index_fever))
```

### Fast Breathing
```{r}
# Long format
radg_fb1 <- addmargins(table(df_radg_cat1fb_l$ref_fastbreath_12mo, df_radg_cat1fb_l$index_fastbreath_12mo))
rownames(radg_fb1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_fb1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

radg_fb2 <- addmargins(table(df_radg_cat2fb_l$ref_fastbreath_35mo, df_radg_cat2fb_l$index_fastbreath_35mo))
rownames(radg_fb2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_fb2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-35 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

radg_fb3 <- addmargins(table(df_radg_cat3fb_l$ref_fastbreath_59mo, df_radg_cat3fb_l$index_fastbreath_59mo))
rownames(radg_fb3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_fb3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**36-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

# Wide format
radg_fb1_m1 <- addmargins(table(df_radg_cat1fb_w$m1_ref_fastbreath_12mo, df_radg_cat1fb_w$m1_index_fastbreath_12mo))
radg_fb1_m2 <- addmargins(table(df_radg_cat1fb_w$m2_ref_fastbreath_12mo, df_radg_cat1fb_w$m2_index_fastbreath_12mo))
radg_fb1_m3 <- addmargins(table(df_radg_cat1fb_w$m3_ref_fastbreath_12mo, df_radg_cat1fb_w$m3_index_fastbreath_12mo))

radg_fb2_m1 <- addmargins(table(df_radg_cat2fb_w$m1_ref_fastbreath_35mo, df_radg_cat2fb_w$m1_index_fastbreath_35mo))
radg_fb2_m2 <- addmargins(table(df_radg_cat2fb_w$m2_ref_fastbreath_35mo, df_radg_cat2fb_w$m2_index_fastbreath_35mo))
radg_fb2_m3 <- addmargins(table(df_radg_cat2fb_w$m3_ref_fastbreath_35mo, df_radg_cat2fb_w$m3_index_fastbreath_35mo))

radg_fb3_m1 <- addmargins(table(df_radg_cat3fb_w$m1_ref_fastbreath_59mo, df_radg_cat3fb_w$m1_index_fastbreath_59mo))
radg_fb3_m2 <- addmargins(table(df_radg_cat3fb_w$m2_ref_fastbreath_59mo, df_radg_cat3fb_w$m2_index_fastbreath_59mo))
radg_fb3_m3 <- addmargins(table(df_radg_cat3fb_w$m3_ref_fastbreath_59mo, df_radg_cat3fb_w$m3_index_fastbreath_59mo))
```

### Tachycardia
```{r}
# Long
radg_tachy1 <- addmargins(table(df_radg_cat1tachy_l$ref_tachycardic_12mo, df_radg_cat1tachy_l$index_tachycardic_12mo))
rownames(radg_tachy1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_tachy1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

radg_tachy2 <- addmargins(table(df_radg_cat2tachy_l$ref_tachycardic_59mo, df_radg_cat2tachy_l$index_tachycardic_59mo))
rownames(radg_tachy2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(radg_tachy2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

# Wide
radg_tachy1_m1 <- addmargins(table(df_radg_cat1tachy_w$m1_ref_tachycardic_12mo, df_radg_cat1tachy_w$m1_index_tachycardic_12mo))
radg_tachy1_m2 <- addmargins(table(df_radg_cat1tachy_w$m2_ref_tachycardic_12mo, df_radg_cat1tachy_w$m2_index_tachycardic_12mo))
radg_tachy1_m3 <- addmargins(table(df_radg_cat1tachy_w$m3_ref_tachycardic_12mo, df_radg_cat1tachy_w$m3_index_tachycardic_12mo))

radg_tachy2_m1 <- addmargins(table(df_radg_cat2tachy_w$m1_ref_tachycardic_59mo, df_radg_cat2tachy_w$m1_index_tachycardic_59mo))
radg_tachy2_m2 <- addmargins(table(df_radg_cat2tachy_w$m2_ref_tachycardic_59mo, df_radg_cat2tachy_w$m2_index_tachycardic_59mo))
radg_tachy2_m3 <- addmargins(table(df_radg_cat2tachy_w$m3_ref_tachycardic_59mo, df_radg_cat2tachy_w$m3_index_tachycardic_59mo))
```

## m800 (Biolight) {.tabset}

### Hypoxia
```{r}
# Long
bio_hypoxia1 <- addmargins(table(df_bio_cat1_l$ref_hypoxic, df_bio_cat1_l$index_hypoxic))
rownames(bio_hypoxia1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_hypoxia1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-1 month**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

bio_hypoxia2 <- addmargins(table(df_bio_cat2_l$ref_hypoxic, df_bio_cat2_l$index_hypoxic))
rownames(bio_hypoxia2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_hypoxia2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**2-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

bio_hypoxia3 <- addmargins(table(df_bio_cat3_l$ref_hypoxic, df_bio_cat3_l$index_hypoxic))
rownames(bio_hypoxia3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_hypoxia3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

# Wide
bio_hypoxia1_m1 <- addmargins(table(df_bio_cat1_w$m1_ref_hypoxic, df_bio_cat1_w$m1_index_hypoxic))
bio_hypoxia1_m2 <- addmargins(table(df_bio_cat1_w$m2_ref_hypoxic, df_bio_cat1_w$m2_index_hypoxic))
bio_hypoxia1_m3 <- addmargins(table(df_bio_cat1_w$m3_ref_hypoxic, df_bio_cat1_w$m3_index_hypoxic))

bio_hypoxia2_m1 <- addmargins(table(df_bio_cat2_w$m1_ref_hypoxic, df_bio_cat2_w$m1_index_hypoxic))
bio_hypoxia2_m2 <- addmargins(table(df_bio_cat2_w$m2_ref_hypoxic, df_bio_cat2_w$m2_index_hypoxic))
bio_hypoxia2_m3 <- addmargins(table(df_bio_cat2_w$m3_ref_hypoxic, df_bio_cat2_w$m3_index_hypoxic))

bio_hypoxia3_m1 <- addmargins(table(df_bio_cat3_w$m1_ref_hypoxic, df_bio_cat3_w$m1_index_hypoxic))
bio_hypoxia3_m2 <- addmargins(table(df_bio_cat3_w$m2_ref_hypoxic, df_bio_cat3_w$m2_index_hypoxic))
bio_hypoxia3_m3 <- addmargins(table(df_bio_cat3_w$m3_ref_hypoxic, df_bio_cat3_w$m3_index_hypoxic))
```

### Fast Breathing
```{r}
bio_fb1 <- addmargins(table(df_bio_cat1fb_l$ref_fastbreath_12mo, df_bio_cat1fb_l$index_fastbreath_12mo))
rownames(bio_fb1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_fb1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

bio_fb2 <- addmargins(table(df_bio_cat2fb_l$ref_fastbreath_35mo, df_bio_cat2fb_l$index_fastbreath_35mo))
rownames(bio_fb2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_fb2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-35 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

bio_fb3 <- addmargins(table(df_bio_cat3fb_l$ref_fastbreath_59mo, df_bio_cat3fb_l$index_fastbreath_59mo))
rownames(bio_fb3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_fb3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**36-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 
```

### Tachycardia
```{r}
bio_tachy1 <- addmargins(table(df_bio_cat1tachy_l$ref_tachycardic_12mo, df_bio_cat1tachy_l$index_tachycardic_12mo))
rownames(bio_tachy1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_tachy1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

bio_tachy2 <- addmargins(table(df_bio_cat2tachy_l$ref_tachycardic_59mo, df_bio_cat2tachy_l$index_tachycardic_59mo))
rownames(bio_tachy2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(bio_tachy2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")
```

## NeoGuard (Neopenda) {.tabset}

### Hypoxia
```{r}
# Long
neo_hypoxia1 <- addmargins(table(df_neo_cat1_l$ref_hypoxic, df_neo_cat1_l$index_hypoxic))
rownames(neo_hypoxia1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_hypoxia1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-1 month**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

neo_hypoxia2 <- addmargins(table(df_neo_cat2_l$ref_hypoxic, df_neo_cat2_l$index_hypoxic))
rownames(neo_hypoxia2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_hypoxia2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**2-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

neo_hypoxia3 <- addmargins(table(df_neo_cat3_l$ref_hypoxic, df_neo_cat3_l$index_hypoxic))
rownames(neo_hypoxia3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_hypoxia3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

# Wide
neo_hypoxia1_m1 <- addmargins(table(df_neo_cat1_w$m1_ref_hypoxic, df_neo_cat1_w$m1_index_hypoxic))
neo_hypoxia1_m2 <- addmargins(table(df_neo_cat1_w$m2_ref_hypoxic, df_neo_cat1_w$m2_index_hypoxic))
neo_hypoxia1_m3 <- addmargins(table(df_neo_cat1_w$m3_ref_hypoxic, df_neo_cat1_w$m3_index_hypoxic))

neo_hypoxia2_m1 <- addmargins(table(df_neo_cat2_w$m1_ref_hypoxic, df_neo_cat2_w$m1_index_hypoxic))
neo_hypoxia2_m2 <- addmargins(table(df_neo_cat2_w$m2_ref_hypoxic, df_neo_cat2_w$m2_index_hypoxic))
neo_hypoxia2_m3 <- addmargins(table(df_neo_cat2_w$m3_ref_hypoxic, df_neo_cat2_w$m3_index_hypoxic))

neo_hypoxia3_m1 <- addmargins(table(df_neo_cat3_w$m1_ref_hypoxic, df_neo_cat3_w$m1_index_hypoxic))
neo_hypoxia3_m2 <- addmargins(table(df_neo_cat3_w$m2_ref_hypoxic, df_neo_cat3_w$m2_index_hypoxic))
neo_hypoxia3_m3 <- addmargins(table(df_neo_cat3_w$m3_ref_hypoxic, df_neo_cat3_w$m3_index_hypoxic))
```

### Fever
```{r}
neo_fever1 <- addmargins(table(df_neo_cat1_l$ref_fever, df_neo_cat1_l$index_fever))
rownames(neo_fever1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_fever1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-1 month**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

neo_fever2 <- addmargins(table(df_neo_cat2_l$ref_fever, df_neo_cat2_l$index_fever))
rownames(neo_fever2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_fever2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**2-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

neo_fever3 <- addmargins(table(df_neo_cat3_l$ref_fever, df_neo_cat3_l$index_fever))
rownames(neo_fever3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_fever3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 
```

### Fast Breathing
```{r}
neo_fb1 <- addmargins(table(df_neo_cat1fb_l$ref_fastbreath_12mo, df_neo_cat1fb_l$index_fastbreath_12mo))
rownames(neo_fb1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_fb1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

neo_fb2 <- addmargins(table(df_neo_cat2fb_l$ref_fastbreath_35mo, df_neo_cat2fb_l$index_fastbreath_35mo))
rownames(neo_fb2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_fb2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-35 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

neo_fb3 <- addmargins(table(df_neo_cat3fb_l$ref_fastbreath_59mo, df_neo_cat3fb_l$index_fastbreath_59mo))
rownames(neo_fb3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_fb3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**36-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 
```

### Tachycardia
```{r}
neo_tachy1 <- addmargins(table(df_neo_cat1tachy_l$ref_tachycardic_12mo, df_neo_cat1tachy_l$index_tachycardic_12mo))
rownames(neo_tachy1) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_tachy1, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**0-11 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

neo_tachy2 <- addmargins(table(df_neo_cat2tachy_l$ref_tachycardic_59mo, df_neo_cat2tachy_l$index_tachycardic_59mo))
rownames(neo_tachy2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(neo_tachy2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")
```

## Onyx PO+RR (Nonin) {.tabset}

### Hypoxia
```{r}
# Long
onyx_hypoxia3 <- addmargins(table(df_onyx_cat3_l$ref_hypoxic, df_onyx_cat3_l$index_hypoxic))
rownames(onyx_hypoxia3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(onyx_hypoxia3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

# Wide
onyx_hypoxia3_m1 <- addmargins(table(df_onyx_cat3_w$m1_ref_hypoxic, df_onyx_cat3_w$m1_index_hypoxic))
onyx_hypoxia3_m2 <- addmargins(table(df_onyx_cat3_w$m2_ref_hypoxic, df_onyx_cat3_w$m2_index_hypoxic))
onyx_hypoxia3_m3 <- addmargins(table(df_onyx_cat3_w$m3_ref_hypoxic, df_onyx_cat3_w$m3_index_hypoxic))
```

### Fast Breathing
```{r}
onyx_fb2 <- addmargins(table(df_onyx_cat2fb_l$ref_fastbreath_35mo, df_onyx_cat2fb_l$index_fastbreath_35mo))
rownames(onyx_fb2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(onyx_fb2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-35 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

onyx_fb3 <- addmargins(table(df_onyx_cat3fb_l$ref_fastbreath_59mo, df_onyx_cat3fb_l$index_fastbreath_59mo))
rownames(onyx_fb3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(onyx_fb3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**36-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 
```

### Tachycardia
```{r}
onyx_tachy2 <- addmargins(table(df_onyx_cat2tachy_l$ref_tachycardic_59mo, df_onyx_cat2tachy_l$index_tachycardic_59mo))
rownames(onyx_tachy2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(onyx_tachy2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")
```

## Scanbo v8 (Scanbo) {.tabset}

### Hypoxia
```{r}
# Long
scan_hypoxia3 <- addmargins(table(df_scan_cat3_l$ref_hypoxic, df_scan_cat3_l$index_hypoxic))
rownames(scan_hypoxia3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(scan_hypoxia3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 

# Wide
scan_hypoxia3_m1 <- addmargins(table(df_scan_cat3_w$m1_ref_hypoxic, df_scan_cat3_w$m1_index_hypoxic))
scan_hypoxia3_m2 <- addmargins(table(df_scan_cat3_w$m2_ref_hypoxic, df_scan_cat3_w$m2_index_hypoxic))
scan_hypoxia3_m3 <- addmargins(table(df_scan_cat3_w$m3_ref_hypoxic, df_scan_cat3_w$m3_index_hypoxic))
```

### Fever
```{r}
scan_fever3 <- addmargins(table(df_scan_cat3_l$ref_fever, df_scan_cat3_l$index_fever))
rownames(scan_fever3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(scan_fever3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 
```

### Fast Breathing
```{r}
scan_fb2 <- addmargins(table(df_scan_cat2fb_l$ref_fastbreath_35mo, df_scan_cat2fb_l$index_fastbreath_35mo))
rownames(scan_fb2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(scan_fb2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-35 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")

scan_fb3 <- addmargins(table(df_scan_cat3fb_l$ref_fastbreath_59mo, df_scan_cat3fb_l$index_fastbreath_59mo))
rownames(scan_fb3) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(scan_fb3, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**36-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") 
```

### Tachycardia
```{r}
scan_tachy2 <- addmargins(table(df_scan_cat2tachy_l$ref_tachycardic_59mo, df_scan_cat2tachy_l$index_tachycardic_59mo))
rownames(scan_tachy2) <- c("Normal (Reference)", "Abnormal (Reference)", "Sum")
kable(scan_tachy2, format = "html", row.names = T, col.names = c("", "Normal (Index)","Abnormal (Index)","Sum"), caption = "**12-59 months**") %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center")
```

# Section 6: Percent Agreement {.tabset}
Samwel (Rebecca can take this if helpful)

```{r, include=FALSE}
# use binom.exact function from exactci package to calculate percent agreement and associated 95% CI's for each device/measurement/age category
# store cacluations in object to call in subsequent sections and display in table

# Rad-G
## Overall
pa_radg_hypoxia1 <- binom.exact(x = sum(radg_hypoxia1[1,1], radg_hypoxia1[2,2]), n = radg_hypoxia1[3,3])
pa_radg_hypoxia2 <- binom.exact(x = sum(radg_hypoxia2[1,1], radg_hypoxia2[2,2]), n = radg_hypoxia2[3,3])
pa_radg_hypoxia3 <- binom.exact(x = sum(radg_hypoxia3[1,1], radg_hypoxia3[2,2]), n = radg_hypoxia3[3,3])

pa_radg_fever1 <- binom.exact(x = sum(radg_fever1[1,1], radg_fever1[2,2]), n = radg_fever1[3,3])
pa_radg_fever2 <- binom.exact(x = sum(radg_fever2[1,1], radg_fever2[2,2]), n = radg_fever2[3,3])
pa_radg_fever3 <- binom.exact(x = sum(radg_fever3[1,1], radg_fever3[2,2]), n = radg_fever3[3,3])

pa_radg_fb1 <- binom.exact(x = sum(radg_fb1[1,1], radg_fb1[2,2]), n = radg_fb1[3,3])
pa_radg_fb2 <- binom.exact(x = sum(radg_fb2[1,1], radg_fb2[2,2]), n = radg_fb2[3,3])
pa_radg_fb3 <- binom.exact(x = sum(radg_fb3[1,1], radg_fb3[2,2]), n = radg_fb3[3,3])

pa_radg_tachy1 <- binom.exact(x = sum(radg_tachy1[1,1], radg_tachy1[2,2]), n = radg_tachy1[3,3])
pa_radg_tachy2 <- binom.exact(x = sum(radg_tachy2[1,1], radg_tachy2[2,2]), n = radg_tachy2[3,3])

## M1-3
### Hypoxia
pa_radg_hypoxia1_m1 <- binom.exact(x = radg_hypoxia1_m1[1,1], n = sum(radg_hypoxia1_m1[1,1], radg_hypoxia1_m1[2,1])) # Intentionally updated to reflect issues with underlying 2x2
pa_radg_hypoxia1_m2 <- binom.exact(x = sum(radg_hypoxia1_m2[1,1], radg_hypoxia1_m2[2,2]), n = radg_hypoxia1_m2[3,3])
pa_radg_hypoxia1_m3 <- binom.exact(x = sum(radg_hypoxia1_m3[1,1], radg_hypoxia1_m3[2,2]), n = radg_hypoxia1_m3[3,3])

pa_radg_hypoxia2_m1 <- binom.exact(x = radg_hypoxia2_m1[1,1], n = sum(radg_hypoxia2_m1[1,1], radg_hypoxia2_m1[2,1])) # Intentionally updated to reflect issues with underlying 2x2
pa_radg_hypoxia2_m2 <- binom.exact(x = sum(radg_hypoxia2_m2[1,1], radg_hypoxia2_m2[2,2]), n = radg_hypoxia2_m2[3,3])
pa_radg_hypoxia2_m3 <- binom.exact(x = sum(radg_hypoxia2_m3[1,1], radg_hypoxia2_m3[2,2]), n = radg_hypoxia2_m3[3,3])

pa_radg_hypoxia3_m1 <- binom.exact(x = radg_hypoxia3_m1[1,1], n = sum(radg_hypoxia3_m1[1,1], radg_hypoxia3_m1[1,2])) # Intentionally updated to reflect issues with underlying 2x2
pa_radg_hypoxia3_m2 <- binom.exact(x = sum(radg_hypoxia3_m2[1,1], radg_hypoxia3_m2[2,2]), n = radg_hypoxia3_m2[3,3])
pa_radg_hypoxia3_m3 <- binom.exact(x = sum(radg_hypoxia3_m3[1,1], radg_hypoxia3_m3[2,2]), n = radg_hypoxia3_m3[3,3])

### Fever

### Fast breathing

### Tachycardia

# Biolight
## Overall
pa_bio_hypoxia1 <- binom.exact(x = sum(bio_hypoxia1[1,1], bio_hypoxia1[2,2]), n = bio_hypoxia1[3,3])
pa_bio_hypoxia2 <- binom.exact(x = sum(bio_hypoxia2[1,1], bio_hypoxia2[2,2]), n = bio_hypoxia2[3,3])
pa_bio_hypoxia3 <- binom.exact(x = sum(bio_hypoxia3[1,1], bio_hypoxia3[2,2]), n = bio_hypoxia3[3,3])

pa_bio_fever1 <- binom.exact(x = sum(bio_fever1[1,1], bio_fever1[2,2]), n = bio_fever1[3,3])
pa_bio_fever2 <- binom.exact(x = sum(bio_fever2[1,1], bio_fever2[2,2]), n = bio_fever2[3,3])
pa_bio_fever3 <- binom.exact(x = sum(bio_fever3[1,1], bio_fever3[2,2]), n = bio_fever3[3,3])

pa_bio_fb1 <- binom.exact(x = sum(bio_fb1[1,1], bio_fb1[2,2]), n = bio_fb1[3,3])
pa_bio_fb2 <- binom.exact(x = sum(bio_fb2[1,1], bio_fb2[2,2]), n = bio_fb2[3,3])
pa_bio_fb3 <- binom.exact(x = sum(bio_fb3[1,1], bio_fb3[2,2]), n = bio_fb3[3,3])

pa_bio_tachy1 <- binom.exact(x = sum(bio_tachy1[1,1], bio_tachy1[2,2]), n = bio_tachy1[3,3])
pa_bio_tachy2 <- binom.exact(x = sum(bio_tachy2[1,1], bio_tachy2[2,2]), n = bio_tachy2[3,3])

## M1-3
### Hypoxia
pa_bio_hypoxia1_m1 <- binom.exact(x = sum(bio_hypoxia1_m1[1,1], bio_hypoxia1_m1[2,2]), n = bio_hypoxia1_m1[3,3])
pa_bio_hypoxia1_m2 <- binom.exact(x = sum(bio_hypoxia1_m2[1,1], bio_hypoxia1_m2[2,2]), n = bio_hypoxia1_m2[3,3])
pa_bio_hypoxia1_m3 <- binom.exact(x = sum(bio_hypoxia1_m3[1,1], bio_hypoxia1_m3[2,2]), n = bio_hypoxia1_m3[3,3])

pa_bio_hypoxia2_m1 <- binom.exact(x = sum(bio_hypoxia2_m1[1,1], bio_hypoxia2_m1[2,2]), n = bio_hypoxia2_m1[3,3])
pa_bio_hypoxia2_m2 <- binom.exact(x = sum(bio_hypoxia2_m2[1,1], bio_hypoxia2_m2[2,2]), n = bio_hypoxia2_m2[3,3])
pa_bio_hypoxia2_m3 <- binom.exact(x = sum(bio_hypoxia2_m3[1,1], bio_hypoxia2_m3[2,2]), n = bio_hypoxia2_m3[3,3])

pa_bio_hypoxia3_m1 <- binom.exact(x = sum(bio_hypoxia3_m1[1,1], bio_hypoxia3_m1[2,2]), n = bio_hypoxia3_m1[3,3])
pa_bio_hypoxia3_m2 <- binom.exact(x = bio_hypoxia3_m2[1,1], n = sum(bio_hypoxia3_m2[1,1], bio_hypoxia3_m2[1,2])) # Intentionally updated to reflect issues with underlying 2x2
pa_bio_hypoxia3_m3 <- binom.exact(x = bio_hypoxia3_m3[1,1], n = sum(bio_hypoxia3_m3[1,1], bio_hypoxia3_m3[1,2])) # Intentionally updated to reflect issues with underlying 2x2

### Fever

### Fast breathing

### Tachycardia

# Neopenda
## Overall
pa_neo_hypoxia1 <- binom.exact(x = sum(neo_hypoxia1[1,1], neo_hypoxia1[2,2]), n = neo_hypoxia1[3,3])
pa_neo_hypoxia2 <- binom.exact(x = sum(neo_hypoxia2[1,1], neo_hypoxia2[2,2]), n = neo_hypoxia2[3,3])
pa_neo_hypoxia3 <- binom.exact(x = sum(neo_hypoxia3[1,1], neo_hypoxia3[2,2]), n = neo_hypoxia3[3,3])

pa_neo_fever1 <- binom.exact(x = sum(neo_fever1[1,1], neo_fever1[2,2]), n = neo_fever1[3,3])
pa_neo_fever2 <- binom.exact(x = sum(neo_fever2[1,1], neo_fever2[2,2]), n = neo_fever2[3,3])
pa_neo_fever3 <- binom.exact(x = sum(neo_fever3[1,1], neo_fever3[2,2]), n = neo_fever3[3,3])

pa_neo_fb1 <- binom.exact(x = sum(neo_fb1[1,1], neo_fb1[2,2]), n = neo_fb1[3,3])
pa_neo_fb2 <- binom.exact(x = sum(neo_fb2[1,1], neo_fb2[2,2]), n = neo_fb2[3,3])
pa_neo_fb3 <- binom.exact(x = sum(neo_fb3[1,1], neo_fb3[2,2]), n = neo_fb3[3,3])

pa_neo_tachy1 <- binom.exact(x = sum(neo_tachy1[1,1], neo_tachy1[2,2]), n = neo_tachy1[3,3])
pa_neo_tachy2 <- binom.exact(x = sum(neo_tachy2[1,1], neo_tachy2[2,2]), n = neo_tachy2[3,3])

## M1-3
### Hypoxia
pa_neo_hypoxia1_m1 <- binom.exact(x = sum(neo_hypoxia1_m1[1,1], neo_hypoxia1_m1[2,2]), n = neo_hypoxia1_m1[3,3])
pa_neo_hypoxia1_m2 <- binom.exact(x = sum(neo_hypoxia1_m2[1,1], neo_hypoxia1_m2[2,2]), n = neo_hypoxia1_m2[3,3])
pa_neo_hypoxia1_m3 <- binom.exact(x = sum(neo_hypoxia1_m3[1,1], neo_hypoxia1_m3[2,2]), n = neo_hypoxia1_m3[3,3])

pa_neo_hypoxia2_m1 <- binom.exact(x = sum(neo_hypoxia2_m1[1,1], neo_hypoxia2_m1[2,2]), n = neo_hypoxia2_m1[3,3])
pa_neo_hypoxia2_m2 <- binom.exact(x = sum(neo_hypoxia2_m2[1,1], neo_hypoxia2_m2[2,2]), n = neo_hypoxia2_m2[3,3])
pa_neo_hypoxia2_m3 <- binom.exact(x = sum(neo_hypoxia2_m3[1,1], neo_hypoxia2_m3[2,2]), n = neo_hypoxia2_m3[3,3])

pa_neo_hypoxia3_m1 <- binom.exact(x = sum(neo_hypoxia3_m1[1,1], neo_hypoxia3_m1[2,2]), n = neo_hypoxia3_m1[3,3])
pa_neo_hypoxia3_m2 <- binom.exact(x = sum(neo_hypoxia3_m2[1,1], neo_hypoxia3_m2[2,2]), n = neo_hypoxia3_m2[3,3])
pa_neo_hypoxia3_m3 <- binom.exact(x = sum(neo_hypoxia3_m3[1,1], neo_hypoxia3_m3[2,2]), n = neo_hypoxia3_m3[3,3])

### Fever

### Fast breathing

### Tachycardia

# Onyx
## Overall
pa_onyx_hypoxia3 <- binom.exact(x = sum(onyx_hypoxia3[1,1], onyx_hypoxia3[2,2]), n = onyx_hypoxia3[3,3])

pa_onyx_fb2 <- binom.exact(x = sum(onyx_fb2[1,1], onyx_fb2[2,2]), n = onyx_fb2[3,3])
pa_onyx_fb3 <- binom.exact(x = sum(onyx_fb3[1,1], onyx_fb3[2,2]), n = onyx_fb3[3,3])

pa_onyx_tachy2 <- binom.exact(x = sum(onyx_tachy2[1,1], onyx_tachy2[2,2]), n = onyx_tachy2[3,3])

## M1-3
### Hypoxia
pa_onyx_hypoxia3_m1 <- binom.exact(x = onyx_hypoxia3_m1[1,1], n = sum(onyx_hypoxia3_m1[1,1], onyx_hypoxia3_m1[2,1])) # Intentionally updated to reflect issues with underlying 2x2
pa_onyx_hypoxia3_m2 <- binom.exact(x = onyx_hypoxia3_m2[1,1], n = sum(onyx_hypoxia3_m2[1,1], onyx_hypoxia3_m2[2,1])) # Intentionally updated to reflect issues with underlying 2x2
pa_onyx_hypoxia3_m3 <- binom.exact(x = onyx_hypoxia3_m3[1,1], n = sum(onyx_hypoxia3_m3[1,1], onyx_hypoxia3_m3[2,1])) # Intentionally updated to reflect issues with underlying 2x2

### Fever

### Fast breathing

### Tachycardia

# Scanbo
## Overall
pa_scan_hypoxia3 <- binom.exact(x = sum(scan_hypoxia3[1,1], scan_hypoxia3[2,2]), n = scan_hypoxia3[3,3])

pa_scan_fever3 <- binom.exact(x = sum(scan_fever3[1,1], scan_fever3[2,2]), n = scan_fever3[3,3])

pa_scan_fb2 <- binom.exact(x = sum(scan_fb2[1,1], scan_fb2[2,2]), n = scan_fb2[3,3])
pa_scan_fb3 <- binom.exact(x = sum(scan_fb3[1,1], scan_fb3[2,2]), n = scan_fb3[3,3])

pa_scan_tachy2 <- binom.exact(x = sum(scan_tachy2[1,1], scan_tachy2[2,2]), n = scan_tachy2[3,3])

## M1-3
### Hypoxia
pa_scan_hypoxia3_m1 <- binom.exact(x = scan_hypoxia3_m1[1,1], n = sum(scan_hypoxia3_m1[1,1], scan_hypoxia3_m1[2,1])) # Intentionally updated to reflect issues with underlying 2x2
pa_scan_hypoxia3_m2 <- binom.exact(x = scan_hypoxia3_m2[1,1], n = sum(scan_hypoxia3_m2[1,1], scan_hypoxia3_m2[2,1])) # Intentionally updated to reflect issues with underlying 2x2
pa_scan_hypoxia3_m3 <- binom.exact(x = scan_hypoxia3_m3[1,1], n = sum(scan_hypoxia3_m3[1,1], scan_hypoxia3_m3[2,1])) # Intentionally updated to reflect issues with underlying 2x2

### Fever

### Fast breathing

### Tachycardia
```

## Hypoxia
```{r}
#need to add other devices
out_hypoxia <- data.frame(col1 = c("", "", "Rad-G", "Biolight", "Neopenda", "Onyx", "Scanbo"),
                    col2 = c("0-1 month", "*Overall*", paste(round(pa_radg_hypoxia1$estimate, 2), "(", round(pa_radg_hypoxia1$conf.int[1], 2)," - ", round(pa_radg_hypoxia1$conf.int[2], 2),")", sep = " ")),
                    col3 = c("0-1 month", "M1", paste(round(pa_radg_hypoxia1_m1$estimate, 2), "(", round(pa_radg_hypoxia1_m1$conf.int[1], 2)," - ", round(pa_radg_hypoxia1_m1$conf.int[2], 2),")", sep = " ")),
                    col4 = c("0-1 month", "M2", paste(round(pa_radg_hypoxia1_m2$estimate, 2), "(", round(pa_radg_hypoxia1_m2$conf.int[1], 2)," - ", round(pa_radg_hypoxia1_m2$conf.int[2], 2),")", sep = " ")),
                    col5 = c("0-1 month", "M3", paste(round(pa_radg_hypoxia1_m3$estimate, 2), "(", round(pa_radg_hypoxia1_m3$conf.int[1], 2)," - ", round(pa_radg_hypoxia1_m3$conf.int[2], 2),")", sep = " ")),
                    col6 = c("2-11 months", "*Overall*", paste(round(pa_radg_hypoxia2$estimate, 2), "(", round(pa_radg_hypoxia2$conf.int[1], 2)," - ", round(pa_radg_hypoxia2$conf.int[2], 2),")", sep = " ")),
                    col7 = c("2-11 months", "M1", paste(round(pa_radg_hypoxia2_m1$estimate, 2), "(", round(pa_radg_hypoxia2_m1$conf.int[1], 2)," - ", round(pa_radg_hypoxia2_m1$conf.int[2], 2),")", sep = " ")),
                    col8 = c("2-11 months", "M2", paste(round(pa_radg_hypoxia2_m2$estimate, 2), "(", round(pa_radg_hypoxia2_m2$conf.int[1], 2)," - ", round(pa_radg_hypoxia2_m2$conf.int[2], 2),")", sep = " ")),
                    col9 = c("2-11 months", "M3", paste(round(pa_radg_hypoxia2_m3$estimate, 2), "(", round(pa_radg_hypoxia2_m3$conf.int[1], 2)," - ", round(pa_radg_hypoxia2_m3$conf.int[2], 2),")", sep = " ")),
                    col10 = c("12-59 months", "*Overall*", paste(round(pa_radg_hypoxia3$estimate, 2), "(", round(pa_radg_hypoxia3$conf.int[1], 2)," - ", round(pa_radg_hypoxia3$conf.int[2], 2),")", sep = " ")),
                    col11 = c("12-59 months", "M1", paste(round(pa_radg_hypoxia3_m1$estimate, 2), "(", round(pa_radg_hypoxia3_m1$conf.int[1], 2)," - ", round(pa_radg_hypoxia3_m1$conf.int[2], 2),")", sep = " ")),
                    col12 = c("12-59 months", "M2", paste(round(pa_radg_hypoxia3_m2$estimate, 2), "(", round(pa_radg_hypoxia3_m2$conf.int[1], 2)," - ", round(pa_radg_hypoxia3_m2$conf.int[2], 2),")", sep = " ")),
                    col13 = c("12-59 months", "M3", paste(round(pa_radg_hypoxia3_m3$estimate, 2), "(", round(pa_radg_hypoxia3_m3$conf.int[1], 2)," - ", round(pa_radg_hypoxia3_m3$conf.int[2], 2),")", sep = " "))
                    )
#to be updated
hypoxia_pa <- kable(out_hypoxia, col.names = c("","Rad-G Temp (Masimo)", "M800 (Biolight)", "NeoGuard (Neopenda)")) %>% 
  kable_styling(bootstrap_options=c("striped","hover","condensed"), position = "center") %>%
  pack_rows("Temperature", 1, 2) %>%
  pack_rows("Oxygen", 3, 4) %>%
  pack_rows("Profusion Index", 5, 6) %>%
  pack_rows("Pulse Rate", 7, 8) %>%
  pack_rows("Respiratory Rate", 9, 10) %>%
  add_header_above(c(" ", "Intraclass correlation coefficient for clinical measures across devices for participantss aged 0-1 month (95%CI)" = 3))
```


## Fever

## Fast Breathing

## Tachycardia
